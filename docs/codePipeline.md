Code Pipeline
=============

We practice [Continuous Deployment](https://en.wikipedia.org/wiki/Continuous_deployment) by utilizing a set
of tools and code that automatically detect, test, deploy and verify changes.

We call this the "CICD Pipeline" or just the "Code Pipeline"

# Github Source Control

Changes to source occur in [Github](usingGithub.md), where eventually a request is made for a given change
to be pulled into the master branch.

# Circle CI Job Runner

We have set up [CircleCI](https://circleci.com/gh/heartpoints/heartpoints.org) to watch for changes to Pull
Requests and to the Master branch, and react according to the [circleci configuration](../.circleci/config.yml),
where we have codified our preferences about how to react to change, what to do, and where to do it.

Ultimately, scripts from the [hp cli]() run inside of the circleci environment to take care of the building,
testing and potential deployment of newly updated version of the system.

## Credentials for CircleCI

Circle needs to connect to github, codecov.io and GCP to do its job properly. Credentials that enable it to do so are stored in environment variables for the circle job:

    gcpCicdServiceAccountCredentialsJson - The JSON credential for the GCP cicd user [see: gke setup](gkeSetup.md)
    CODECOV_TOKEN: The token generated by codecov.io upon account setup

CircleCI and CodeCov.io both use github oauth access to set up their integrations with github. Those credentials
are not stored anywhere and required manual oauth on the website during account setup.

The remaining creds are in a private [repository](https://github.com/heartpoints/credentials) for safekeeping.

# Deployment to Production

The above-mentioned scripts deploy to our production kubernetes environment using the credentials as mentioned.